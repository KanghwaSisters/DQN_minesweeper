{"cells":[{"cell_type":"markdown","metadata":{"id":"rdETq6egdSWb"},"source":["# 00 Init"]},{"cell_type":"markdown","metadata":{"id":"8HOAjQuwL7sN"},"source":["## Mount"]},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":18502,"status":"ok","timestamp":1715184259107,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"ui3DIJhjL9gg","outputId":"cfcbe634-df50-4dc3-8412-2ecbe2ed9656"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"markdown","metadata":{"id":"78w_wKa0U7RQ"},"source":["## Setting to use py files"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":7,"status":"ok","timestamp":1715184259107,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"0pxUvG0xL7sP"},"outputs":[],"source":["import os"]},{"cell_type":"code","execution_count":6,"metadata":{"executionInfo":{"elapsed":6,"status":"ok","timestamp":1715184259107,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"bMOGX54HPnN4"},"outputs":[],"source":["os.chdir('/content/drive/MyDrive/Minesweeper [RL]')"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":35},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1715184259107,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"Irw-aDyCMS39","outputId":"a1a045fb-3ebd-4f9a-f584-5e0152d5671f"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'/content/drive/MyDrive/Minesweeper [RL]'"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["# check that os is in right directory\n","os.getcwd()"]},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6464,"status":"ok","timestamp":1715184265567,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"Sr1xfdJ6PsFk","outputId":"1663f819-dfe6-4a69-b558-c3225a5c09a0"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting codes\n","  Downloading codes-0.1.5-py3-none-any.whl (5.5 kB)\n","Installing collected packages: codes\n","Successfully installed codes-0.1.5\n"]}],"source":["! pip install codes"]},{"cell_type":"markdown","metadata":{"id":"tOZz1bXTVUae"},"source":["## Import py files"]},{"cell_type":"code","execution_count":21,"metadata":{"executionInfo":{"elapsed":2,"status":"ok","timestamp":1715184413782,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"8QtWl0d3Owjd"},"outputs":[],"source":["# baseline : Env, Agent\n","from codes.agent.DQNAgentWithoutRules import *\n","from codes.trainer.trainerWithValidShutDown import *\n","# import codes.trainer.trainerWithValidShutDown as Trainer\n","from codes.environment.env5rewardWithoutDone import *"]},{"cell_type":"markdown","metadata":{"id":"EQB8jukRfMvE"},"source":["## Import Libraries"]},{"cell_type":"code","execution_count":9,"metadata":{"executionInfo":{"elapsed":20,"status":"ok","timestamp":1715184276435,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"1-bbzUkJfQZv"},"outputs":[],"source":[]},{"cell_type":"markdown","metadata":{"id":"pmz1e_BTfYrZ"},"source":["# 01 Info"]},{"cell_type":"markdown","metadata":{"id":"1p29QQ5GAndP"},"source":["## level dictionary"]},{"cell_type":"code","execution_count":10,"metadata":{"executionInfo":{"elapsed":19,"status":"ok","timestamp":1715184276435,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"Vso5fXO-_hH8"},"outputs":[],"source":["level = {'easy' : {'map_size':(9,9), 'n_mines' : 10},\n","         'medium' : {'map_size':(16,16), 'n_mines':40},\n","         'expert' : {'map_size':(16,30), 'n_mines':99}}"]},{"cell_type":"markdown","metadata":{"id":"M9gDUMM9WBXa"},"source":["## HYPER PARAMETERS"]},{"cell_type":"code","execution_count":11,"metadata":{"executionInfo":{"elapsed":18,"status":"ok","timestamp":1715184276435,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"ru8shHIbWDZX"},"outputs":[],"source":["# Environment settings\n","MEM_SIZE = 50000\n","MEM_SIZE_MIN = 1000\n","\n","# Learning settings\n","BATCH_SIZE = 64\n","LEARNING_RATE = 0.01\n","LEARN_DECAY = 0.99975\n","LEARN_MIN = 0.001\n","DISCOUNT = 0.1\n","\n","# Exploration settings\n","EPSILON = 0.95\n","EPSILON_DECAY = 0.999975\n","EPSILON_MIN = 0.01\n","\n","# DQN settings\n","CONV_UNITS = 64\n","UPDATE_TARGET_EVERY = 5"]},{"cell_type":"markdown","metadata":{"id":"TSbDwBaZgg46"},"source":["# 02 Train, Valid"]},{"cell_type":"code","execution_count":14,"metadata":{"executionInfo":{"elapsed":3035,"status":"ok","timestamp":1715184319754,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"9YIE1PWMO1Sm"},"outputs":[],"source":["env = MinesweeperEnv(map_size=level['expert']['map_size'],\n","                     n_mines=level['expert']['n_mines'],\n","                     rewards={'win':1, 'lose':-1, 'progress':0.3, 'guess':-0.3, 'no_progress' : -0.5})\n","agent = Limited18DQNAgent(env=env, conv_units=CONV_UNITS)"]},{"cell_type":"markdown","metadata":{"id":"7L5dNbnpiYjH"},"source":["## TRAIN_PARAMETERS"]},{"cell_type":"code","execution_count":15,"metadata":{"executionInfo":{"elapsed":338,"status":"ok","timestamp":1715184323360,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"6p9LbiVfjFvA"},"outputs":[],"source":["EPISODES = 100000\n","PRINT_INTERVAL = 100\n","TRAIN_RENDER = False\n","\n","TRAIN_INTERVALS = ['every timestep', 'every episodes']\n","TRAIN_INTERVAL = TRAIN_INTERVALS[0]\n","\n","VALID_SAMPLE = 1000\n","VALID_INTERVAL = 10"]},{"cell_type":"code","execution_count":20,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":141},"executionInfo":{"elapsed":472,"status":"error","timestamp":1715184407723,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"ZbKwyaFaOB8N"},"outputs":[{"name":"stdout","output_type":"stream","text":["Episode: [50000/500], Median progress: 5.00, Median reward: -2.20, Win rate : 0.00, Epsilon: 0.88\n"]}],"source":["expert = Trainer(env, agent, 'expert')"]},{"cell_type":"markdown","metadata":{"id":"VmPPxw9HkyVV"},"source":["## Transfer Learning\n","모델을 fine tuning해준다.  \n","출처 : https://tutorials.pytorch.kr/beginner/transfer_learning_tutorial.html"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"muA9v81Gk067"},"outputs":[],"source":["with open('/content/drive/MyDrive/Minesweeper [RL]/models/noRewardsWithValidShutDown_5/100K.pkl', 'rb') as f:\n","    easy = pickle.load(f)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3,"status":"ok","timestamp":1714927576697,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"InNSQp3Spgqi","outputId":"90544f65-edd8-4dec-e0ab-e0bf0b0a32e5"},"outputs":[{"data":{"text/plain":["Linear(in_features=36864, out_features=480, bias=True)"]},"execution_count":17,"metadata":{},"output_type":"execute_result"}],"source":["expert.agent.model.fc"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":620,"status":"ok","timestamp":1714927531501,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"vgV_a2iPpV9L","outputId":"7b182b9f-dce3-46cd-adca-06dd2422afd8"},"outputs":[{"data":{"text/plain":["Linear(in_features=7744, out_features=81, bias=True)"]},"execution_count":16,"metadata":{},"output_type":"execute_result"}],"source":["easy.agent.model.fc"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1714927629123,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"S5idHs3MplwS","outputId":"77082a97-1ebd-49ce-a840-255cfd33f4c1"},"outputs":[{"data":{"text/plain":["DQN(\n","  (conv1): Conv2d(1, 64, kernel_size=(3, 3), stride=(1, 1), padding=(2, 2), bias=False)\n","  (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)\n","  (conv3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)\n","  (conv4): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)\n","  (flatten): Flatten(start_dim=1, end_dim=-1)\n","  (fc): Linear(in_features=36864, out_features=480, bias=True)\n",")"]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["easy.agent.model.fc = nn.Linear(36864, 480)\n","easy.agent.model"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":478,"status":"ok","timestamp":1714927708525,"user":{"displayName":"Jimin Lee","userId":"01372747766781604817"},"user_tz":-540},"id":"p0wyRqkDlH4Q","outputId":"26f2778c-9c93-45ad-d793-69db4b63a1ed"},"outputs":[{"data":{"text/plain":["\u003cAll keys matched successfully\u003e"]},"execution_count":22,"metadata":{},"output_type":"execute_result"}],"source":["# transfer models\n","expert.agent.model.load_state_dict(easy.agent.model.state_dict())\n","expert.agent.target_model.load_state_dict(easy.agent.model.state_dict())"]},{"cell_type":"markdown","metadata":{"id":"n7yo36PKp657"},"source":["## train start"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"aTp_hSfwp6QA","outputId":"de335393-0b0f-40a9-84ab-2dd2edc38026"},"outputs":[{"name":"stdout","output_type":"stream","text":["Episode: [50000/500], Median progress: 5.00, Median reward: -2.15, Win rate : 0.00, Epsilon: 0.83\n","Episode: [50000/600], Median progress: 5.00, Median reward: -1.90, Win rate : 0.00, Epsilon: 0.71\n","Episode: [50000/700], Median progress: 5.00, Median reward: -1.90, Win rate : 0.00, Epsilon: 0.61\n","Episode: [50000/800], Median progress: 5.00, Median reward: -2.25, Win rate : 0.00, Epsilon: 0.51\n","Episode: [50000/900], Median progress: 4.50, Median reward: -2.00, Win rate : 0.00, Epsilon: 0.43\n","Episode: [50000/1000], Median progress: 5.00, Median reward: -2.10, Win rate : 0.00, Epsilon: 0.35\n","Episode: [50000/1100], Median progress: 6.50, Median reward: -3.00, Win rate : 0.00, Epsilon: 0.28\n","Episode: [50000/1200], Median progress: 6.00, Median reward: -2.50, Win rate : 0.00, Epsilon: 0.22\n","Episode: [50000/1300], Median progress: 7.00, Median reward: -2.55, Win rate : 0.00, Epsilon: 0.17\n","Episode: [50000/1400], Median progress: 5.00, Median reward: -2.20, Win rate : 0.00, Epsilon: 0.13\n","Episode: [50000/1500], Median progress: 5.00, Median reward: -1.60, Win rate : 0.00, Epsilon: 0.10\n","Episode: [50000/1600], Median progress: 4.00, Median reward: -1.30, Win rate : 0.00, Epsilon: 0.07\n","Episode: [50000/1700], Median progress: 7.00, Median reward: -2.20, Win rate : 0.00, Epsilon: 0.05\n","Episode: [50000/1800], Median progress: 4.00, Median reward: -1.90, Win rate : 0.00, Epsilon: 0.03\n","Episode: [50000/1900], Median progress: 4.50, Median reward: -1.60, Win rate : 0.00, Epsilon: 0.02\n"]}],"source":["expert.train()\n","expert.visualize_train()\n","expert.save_model()"]}],"metadata":{"accelerator":"GPU","colab":{"authorship_tag":"ABX9TyOBSzT+IQVqDzDfjbmLcB7W","gpuType":"T4","name":"","version":""},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}